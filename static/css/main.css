        :root {
            --bg-deep: #0a0b0f;
            --bg-card: rgba(255,255,255,0.035);
            --bg-card-hover: rgba(255,255,255,0.06);
            --border: rgba(255,255,255,0.07);
            --text-primary: #e8eaed;
            --text-secondary: #7a7f8a;
            --text-muted: #4a4e5a;
            --green: #34d399;
            --green-dim: rgba(52,211,153,0.15);
            --red: #f87171;
            --red-dim: rgba(248,113,113,0.15);
            --amber: #fbbf24;
            --amber-dim: rgba(251,191,36,0.15);
            --blue: #60a5fa;
            --blue-dim: rgba(96,165,250,0.15);
            --purple: #a78bfa;
            --purple-dim: rgba(167,139,250,0.12);
            --mono: 'JetBrains Mono', 'SF Mono', monospace;
            --sans: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            --radius: 14px;
            --radius-sm: 8px;
        }

        /* ─── LIGHT THEME ─── */
        [data-theme="light"] {
            --bg-deep: #f2f3f7;
            --bg-card: rgba(0,0,0,0.03);
            --bg-card-hover: rgba(0,0,0,0.055);
            --border: rgba(0,0,0,0.08);
            --text-primary: #1a1c24;
            --text-secondary: #5c6170;
            --text-muted: #8b90a0;
            --green: #16a34a;
            --green-dim: rgba(22,163,74,0.12);
            --red: #dc2626;
            --red-dim: rgba(220,38,38,0.1);
            --amber: #d97706;
            --amber-dim: rgba(217,119,6,0.1);
            --blue: #2563eb;
            --blue-dim: rgba(37,99,235,0.1);
            --purple: #7c3aed;
            --purple-dim: rgba(124,58,237,0.1);
        }
        [data-theme="light"] .card-value { color: #111318; }
        [data-theme="light"] .sr-value { color: #111318; }
        [data-theme="light"] .status-row { background: rgba(0,0,0,0.025); }
        [data-theme="light"] .tl-block.idle { background: rgba(0,0,0,0.07); }
        [data-theme="light"] .app-bar { background: rgba(0,0,0,0.07); }
        [data-theme="light"] .modal { background: #ffffff; }
        [data-theme="light"] .blur-overlay { background: rgba(242,243,247,0.92); }
        [data-theme="light"] .blur-overlay .big-timer { color: #111318; }
        [data-theme="light"] .blur-overlay .skip-btn { border-color: rgba(0,0,0,0.15); color: var(--text-muted); }
        [data-theme="light"] .blur-overlay .skip-btn:hover { border-color: var(--red); color: var(--red); }
        [data-theme="light"] .todo-input,
        [data-theme="light"] .todo-date-input,
        [data-theme="light"] .setting-input {
            background: rgba(0,0,0,0.035); color: #111318;
        }
        [data-theme="light"] .todo-input::placeholder { color: var(--text-muted); }
        [data-theme="light"] .todo-date-input::-webkit-calendar-picker-indicator { filter: none; }
        [data-theme="light"] .pomo-time { color: #111318; }
        [data-theme="light"] .pomo-ring .bg { stroke: rgba(0,0,0,0.07); }
        [data-theme="light"] .neuro-track { background: rgba(0,0,0,0.06); }
        [data-theme="light"] .slider { background: #c4c8d4; }
        [data-theme="light"] .btn { background: rgba(0,0,0,0.03); color: var(--text-primary); }
        [data-theme="light"] .btn:hover { background: rgba(0,0,0,0.07); }
        [data-theme="light"] .recovery-msg { background: rgba(22,163,74,0.06); border-color: rgba(22,163,74,0.15); }
        [data-theme="light"] .recovery-msg.warning { background: rgba(217,119,6,0.06); border-color: rgba(217,119,6,0.15); }
        [data-theme="light"] .recovery-msg.danger { background: rgba(220,38,38,0.06); border-color: rgba(220,38,38,0.15); }
        [data-theme="light"] .todo-check.done { color: #fff; }
        [data-theme="light"] .voice-btn { color: var(--text-secondary); }
        [data-theme="light"] .nav-tab:hover { background: rgba(0,0,0,0.04); }
        [data-theme="light"] .nav-tab.active { background: rgba(0,0,0,0.07); }
        [data-theme="light"] .logo h1 {
            background: linear-gradient(135deg, var(--green), var(--blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        [data-theme="light"] .app-bar-fill { background: linear-gradient(90deg, var(--blue), var(--purple)); }
        [data-theme="light"] .badge-green { background: var(--green-dim); color: var(--green); }
        [data-theme="light"] .badge-red { background: var(--red-dim); color: var(--red); }
        [data-theme="light"] .badge-amber { background: var(--amber-dim); color: var(--amber); }
        [data-theme="light"] .badge-blue { background: var(--blue-dim); color: var(--blue); }

        /* ─── THEME TOGGLE BUTTON ─── */
        .theme-toggle {
            width: 38px; height: 38px; border-radius: 10px;
            border: 1px solid var(--border); background: var(--bg-card);
            cursor: pointer; transition: all .25s ease;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; line-height: 1; position: relative; overflow: hidden;
        }
        .theme-toggle:hover { background: var(--bg-card-hover); transform: scale(1.05); }
        .theme-toggle .icon-sun,
        .theme-toggle .icon-moon {
            position: absolute; transition: all .35s cubic-bezier(.4,.0,.2,1);
        }
        .theme-toggle .icon-sun { opacity: 0; transform: rotate(-90deg) scale(0.5); }
        .theme-toggle .icon-moon { opacity: 1; transform: rotate(0deg) scale(1); }
        [data-theme="light"] .theme-toggle .icon-sun { opacity: 1; transform: rotate(0deg) scale(1); }
        [data-theme="light"] .theme-toggle .icon-moon { opacity: 0; transform: rotate(90deg) scale(0.5); }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: var(--sans);
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background .35s ease, color .35s ease;
        }

        /* Subtle grid texture */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 24px 24px;
            pointer-events: none;
            z-index: 0;
        }

        .app { position: relative; z-index: 1; padding: 20px 24px 40px; max-width: 1480px; margin: 0 auto; }

        /* ─── HEADER ─── */
        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 28px; padding-bottom: 18px;
            border-bottom: 1px solid var(--border);
        }
        .logo { display:flex; align-items:center; gap:12px; }
        .logo h1 {
            font-size: 20px; font-weight: 700; letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--green), var(--blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .logo .ver { font-family: var(--mono); font-size:11px; color:var(--text-muted); padding:2px 8px; border:1px solid var(--border); border-radius:20px; }
        .header-right { display:flex; align-items:center; gap:16px; }
        .live-dot { width:8px; height:8px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
        .live-dot.off { background:var(--red); animation:none; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }
        .header-time { font-family:var(--mono); font-size:12px; color:var(--text-muted); }

        /* ─── NAV TABS ─── */
        .nav-tabs {
            display:flex; gap:4px; margin-bottom:24px;
            background: var(--bg-card); border-radius:12px; padding:4px;
            border: 1px solid var(--border); width:fit-content;
        }
        .nav-tab {
            padding:8px 20px; border-radius:8px; font-size:13px; font-weight:500;
            color:var(--text-secondary); cursor:pointer; transition:all .2s;
            border:none; background:none; font-family:var(--sans);
        }
        .nav-tab:hover { color:var(--text-primary); background:rgba(255,255,255,0.04); }
        .nav-tab.active { color:var(--text-primary); background:rgba(255,255,255,0.08); }

        .tab-content { display:none; }
        .tab-content.active { display:block; }

        /* ─── CARDS ─── */
        .card {
            background: var(--bg-card); border:1px solid var(--border);
            border-radius: var(--radius); padding:20px;
            transition: background .25s ease, border-color .25s ease;
        }
        .card:hover { background: var(--bg-card-hover); }
        .card-title {
            font-size:11px; font-weight:600; color:var(--text-muted);
            text-transform:uppercase; letter-spacing:1.5px; margin-bottom:10px;
        }
        .card-value { font-size:28px; font-weight:900; color:#fff; font-family:var(--mono); }
        .card-sub { font-size:12px; color:var(--text-secondary); margin-top:4px; }

        /* ─── GRIDS ─── */
        .g4 { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-bottom:20px; }
        .g2 { display:grid; grid-template-columns:2fr 1fr; gap:14px; margin-bottom:20px; }
        .g3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; margin-bottom:20px; }
        .g2e { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:20px; }

        /* ─── TIMELINE ─── */
        .timeline-wrap { overflow-x:auto; padding:8px 0; }
        .timeline { display:flex; gap:2px; min-width:max-content; }
        .tl-block {
            width:7px; height:36px; border-radius:2px; cursor:pointer;
            transition:transform .15s;
        }
        .tl-block:hover { transform:scaleY(1.3); }
        .tl-block.prod { background:var(--green); }
        .tl-block.dist { background:var(--red); }
        .tl-block.neut { background:var(--amber); }
        .tl-block.idle { background:rgba(255,255,255,0.06); }
        .tl-legend { display:flex; gap:14px; margin-top:10px; font-size:11px; color:var(--text-muted); }

        /* ─── STATUS ROWS ─── */
        .status-row {
            display:flex; justify-content:space-between; align-items:center;
            padding:10px 14px; background:rgba(255,255,255,0.02); border-radius:var(--radius-sm);
            margin-bottom:6px;
        }
        .status-row:last-child { margin-bottom:0; }
        .sr-label { font-size:13px; color:var(--text-secondary); }
        .sr-value { font-size:13px; font-weight:600; color:#fff; }
        .badge { padding:3px 10px; border-radius:20px; font-size:11px; font-weight:600; }
        .badge-green { background:var(--green-dim); color:var(--green); }
        .badge-red { background:var(--red-dim); color:var(--red); }
        .badge-amber { background:var(--amber-dim); color:var(--amber); }
        .badge-blue { background:var(--blue-dim); color:var(--blue); }

        /* ─── CHART ─── */
        .chart-box { position:relative; height:260px; }
        .chart-box.sm { height:200px; }

        /* ─── APP LIST ─── */
        .app-item { display:flex; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid var(--border); }
        .app-item:last-child { border-bottom:none; }
        .app-ico { width:28px; height:28px; border-radius:6px; background:var(--bg-card); display:flex; align-items:center; justify-content:center; font-size:13px; }
        .app-info { flex:1; }
        .app-name { font-size:13px; font-weight:500; }
        .app-time { font-size:11px; color:var(--text-muted); }
        .app-bar { width:80px; height:4px; background:rgba(255,255,255,0.06); border-radius:2px; overflow:hidden; }
        .app-bar-fill { height:100%; background:linear-gradient(90deg,var(--blue),var(--purple)); border-radius:2px; }

        /* ─── POMODORO ─── */
        .pomo-ring-container { display:flex; flex-direction:column; align-items:center; gap:16px; padding:16px 0; }
        .pomo-ring { position:relative; width:200px; height:200px; }
        .pomo-ring svg { width:200px; height:200px; transform:rotate(-90deg); }
        .pomo-ring .bg { fill:none; stroke:rgba(255,255,255,0.06); stroke-width:8; }
        .pomo-ring .fg { fill:none; stroke-width:8; stroke-linecap:round; transition:stroke-dashoffset 1s linear, stroke .3s; }
        .pomo-center {
            position:absolute; inset:0; display:flex; flex-direction:column;
            align-items:center; justify-content:center;
        }
        .pomo-time { font-family:var(--mono); font-size:42px; font-weight:700; color:#fff; }
        .pomo-label { font-size:12px; color:var(--text-secondary); margin-top:2px; }
        .pomo-cycles { display:flex; gap:8px; }
        .pomo-dot { width:12px; height:12px; border-radius:50%; border:2px solid var(--border); }
        .pomo-dot.done { background:var(--green); border-color:var(--green); }
        .pomo-dot.current { border-color:var(--amber); box-shadow:0 0 8px var(--amber); }
        .pomo-btns { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }

        .btn {
            padding:8px 18px; border-radius:var(--radius-sm); font-size:13px; font-weight:600;
            border:1px solid var(--border); cursor:pointer; transition:all .2s;
            font-family:var(--sans); background:var(--bg-card); color:var(--text-primary);
        }
        .btn:hover { background:rgba(255,255,255,0.08); }
        .btn-green { border-color:var(--green); color:var(--green); }
        .btn-green:hover { background:var(--green-dim); }
        .btn-red { border-color:var(--red); color:var(--red); }
        .btn-red:hover { background:var(--red-dim); }
        .btn-amber { border-color:var(--amber); color:var(--amber); }
        .btn-amber:hover { background:var(--amber-dim); }
        .btn-blue { border-color:var(--blue); color:var(--blue); }
        .btn-blue:hover { background:var(--blue-dim); }
        .btn-sm { padding:5px 12px; font-size:12px; }

        /* ─── RECOVERY INDICATOR ─── */
        .recovery-panel { padding:16px 0; }
        .neuro-bars { display:flex; flex-direction:column; gap:12px; }
        .neuro-row { display:flex; align-items:center; gap:10px; }
        .neuro-icon { font-size:16px; width:24px; text-align:center; }
        .neuro-label { font-size:12px; color:var(--text-secondary); width:100px; flex-shrink:0; }
        .neuro-track { flex:1; height:6px; background:rgba(255,255,255,0.06); border-radius:3px; overflow:hidden; }
        .neuro-fill { height:100%; border-radius:3px; transition:width .8s ease; }
        .neuro-fill.nt { background:linear-gradient(90deg,#f87171,#34d399); }
        .neuro-fill.ar { background:linear-gradient(90deg,#fbbf24,#34d399); }
        .neuro-fill.ci { background:linear-gradient(90deg,#34d399,#f87171); }
        .neuro-pct { font-family:var(--mono); font-size:11px; color:var(--text-muted); width:36px; text-align:right; }
        .recovery-msg {
            margin-top:16px; padding:14px; border-radius:var(--radius-sm);
            background:rgba(52,211,153,0.08); border:1px solid rgba(52,211,153,0.15);
            font-size:13px; line-height:1.6;
        }
        .recovery-msg.warning { background:rgba(251,191,36,0.08); border-color:rgba(251,191,36,0.15); }
        .recovery-msg.danger { background:rgba(248,113,113,0.08); border-color:rgba(248,113,113,0.15); }
        .recovery-msg-title { font-weight:700; margin-bottom:4px; }

        /* ─── REPORT MODAL ─── */
        .modal-overlay {
            display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7);
            backdrop-filter:blur(8px); z-index:1000; align-items:center; justify-content:center;
        }
        .modal-overlay.show { display:flex; }
        .modal {
            background:#12131a; border:1px solid var(--border); border-radius:20px;
            width:90%; max-width:720px; max-height:85vh; overflow-y:auto; padding:32px;
        }
        .modal h2 { font-size:22px; font-weight:900; margin-bottom:6px; }
        .modal .date-sub { font-size:13px; color:var(--text-muted); margin-bottom:24px; }
        .report-stat-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:24px; }
        .report-stat {
            text-align:center; padding:16px; background:var(--bg-card);
            border-radius:var(--radius-sm); border:1px solid var(--border);
        }
        .report-stat .val { font-family:var(--mono); font-size:24px; font-weight:700; }
        .report-stat .lab { font-size:11px; color:var(--text-muted); margin-top:4px; text-transform:uppercase; letter-spacing:1px; }
        .suggestion-card {
            display:flex; gap:12px; padding:14px; border-radius:var(--radius-sm);
            background:var(--bg-card); border:1px solid var(--border); margin-bottom:8px;
        }
        .suggestion-icon { font-size:20px; flex-shrink:0; margin-top:2px; }
        .suggestion-body {}
        .suggestion-title { font-size:14px; font-weight:600; margin-bottom:2px; }
        .suggestion-text { font-size:13px; color:var(--text-secondary); line-height:1.5; }
        .delta-up { color:var(--green); }
        .delta-down { color:var(--red); }

        /* ─── TODO LIST ─── */
        .todo-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
        .todo-input-row { display:flex; gap:8px; margin-bottom:14px; }
        .todo-input {
            flex:1; padding:10px 14px; border-radius:var(--radius-sm);
            background:rgba(255,255,255,0.04); border:1px solid var(--border);
            color:#fff; font-size:14px; font-family:var(--sans);
        }
        .todo-input:focus { outline:none; border-color:var(--blue); }
        .todo-input::placeholder { color:var(--text-muted); }
        .todo-date-input {
            width:140px; padding:10px 12px; border-radius:var(--radius-sm);
            background:rgba(255,255,255,0.04); border:1px solid var(--border);
            color:#fff; font-size:13px; font-family:var(--mono);
        }
        .todo-date-input:focus { outline:none; border-color:var(--blue); }
        .todo-date-input::-webkit-calendar-picker-indicator { filter:invert(0.7); }
        .voice-btn {
            width:40px; height:40px; border-radius:50%; border:1px solid var(--border);
            background:var(--bg-card); color:var(--text-secondary); font-size:18px;
            cursor:pointer; transition:all .2s; display:flex; align-items:center; justify-content:center;
        }
        .voice-btn:hover { border-color:var(--red); color:var(--red); }
        .voice-btn.recording { background:var(--red-dim); border-color:var(--red); color:var(--red); animation:pulse 1s infinite; }
        .todo-list { max-height:400px; overflow-y:auto; }
        .todo-item {
            display:flex; align-items:center; gap:10px; padding:10px 0;
            border-bottom:1px solid var(--border);
        }
        .todo-item:last-child { border-bottom:none; }
        .todo-check {
            width:20px; height:20px; border-radius:50%; border:2px solid var(--border);
            cursor:pointer; transition:all .2s; flex-shrink:0;
            display:flex; align-items:center; justify-content:center; font-size:11px; color:transparent;
        }
        .todo-check:hover { border-color:var(--green); }
        .todo-check.done { background:var(--green); border-color:var(--green); color:#fff; }
        .todo-body { flex:1; min-width:0; }
        .todo-title { font-size:14px; font-weight:500; }
        .todo-title.done { text-decoration:line-through; color:var(--text-muted); }
        .todo-meta { font-size:11px; color:var(--text-muted); margin-top:2px; display:flex; gap:8px; }
        .todo-meta .overdue { color:var(--red); font-weight:600; }
        .todo-del {
            width:24px; height:24px; border-radius:4px; border:none; background:none;
            color:var(--text-muted); cursor:pointer; font-size:14px; transition:all .2s;
            display:flex; align-items:center; justify-content:center;
        }
        .todo-del:hover { color:var(--red); background:var(--red-dim); }
        .todo-stats { display:flex; gap:16px; font-size:12px; color:var(--text-muted); padding:8px 0; }
        .voice-hint { font-size:11px; color:var(--amber); padding:6px 0; display:none; }
        .voice-hint.show { display:block; }
        .smart-parse-preview {
            background: var(--card-bg); border:1px solid var(--border); border-radius:8px;
            padding:10px 12px; margin-bottom:12px; margin-top:2px;
        }
        .parse-tag {
            display:inline-block; font-size:12px; padding:2px 8px; border-radius:4px;
            background:var(--blue-dim,rgba(59,130,246,0.1)); color:var(--blue);
        }
        .parse-tag-list { display:inline-flex; gap:4px; }
        .parse-tag-list .tag-item {
            font-size:11px; padding:1px 6px; border-radius:3px;
            background:var(--green-dim,rgba(16,185,129,0.1)); color:var(--green);
        }

        /* ─── SCREEN BLUR OVERLAY ─── */
        .blur-overlay {
            display:none; position:fixed; inset:0; z-index:2000;
            background:rgba(10,11,15,0.85); backdrop-filter:blur(30px);
            flex-direction:column; align-items:center; justify-content:center; gap:20px;
        }
        .blur-overlay.show { display:flex; }
        .blur-overlay .big-timer { font-family:var(--mono); font-size:80px; font-weight:700; color:#fff; }
        .blur-overlay .blur-msg { font-size:18px; color:var(--text-secondary); text-align:center; line-height:1.6; }
        .blur-overlay .skip-btn {
            margin-top:20px; padding:10px 24px; border-radius:var(--radius-sm);
            background:none; border:1px solid rgba(255,255,255,0.15); color:var(--text-muted);
            font-size:13px; cursor:pointer; transition:all .3s; font-family:var(--sans);
        }
        .blur-overlay .skip-btn:hover { border-color:var(--red); color:var(--red); }

        /* ─── SETTINGS ─── */
        .settings-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:16px; }
        .setting-group { display:flex; flex-direction:column; gap:6px; }
        .setting-label { font-size:12px; color:var(--text-secondary); }
        .setting-input {
            padding:8px 12px; border-radius:var(--radius-sm);
            background:rgba(255,255,255,0.04); border:1px solid var(--border);
            color:#fff; font-size:13px; font-family:var(--mono); width:100%;
        }
        .setting-input:focus { outline:none; border-color:var(--blue); }
        .switch { position:relative; display:inline-block; width:44px; height:24px; }
        .switch input { opacity:0; width:0; height:0; }
        .slider { position:absolute; cursor:pointer; inset:0; background:#3f3f46; border-radius:24px; transition:.3s; }
        .slider:before { content:""; position:absolute; height:18px; width:18px; left:3px; bottom:3px; background:#fff; border-radius:50%; transition:.3s; }
        input:checked + .slider { background:var(--green); }
        input:checked + .slider:before { transform:translateX(20px); }

        /* ─── FLOATING CHAT WIDGET ─── */
        .chat-fab {
            position:fixed; bottom:24px; right:24px; z-index:900;
            width:54px; height:54px; border-radius:50%;
            background:linear-gradient(135deg,var(--green),var(--blue));
            border:none; cursor:pointer; font-size:24px;
            box-shadow:0 4px 20px rgba(0,0,0,0.3);
            transition:all .3s cubic-bezier(.4,0,.2,1);
            display:flex; align-items:center; justify-content:center;
        }
        .chat-fab:hover { transform:scale(1.08); box-shadow:0 6px 28px rgba(0,0,0,0.4); }
        .chat-fab.open { transform:rotate(45deg); background:var(--red); }

        .chat-panel {
            position:fixed; bottom:90px; right:24px; z-index:899;
            width:380px; max-height:520px; border-radius:var(--radius);
            background:var(--bg-deep); border:1px solid var(--border);
            box-shadow:0 12px 40px rgba(0,0,0,0.5);
            display:none; flex-direction:column;
            overflow:hidden; transition:all .3s ease;
        }
        .chat-panel.show { display:flex; }
        [data-theme="light"] .chat-panel { background:#fff; box-shadow:0 8px 32px rgba(0,0,0,0.15); }

        .chat-header {
            display:flex; align-items:center; justify-content:space-between;
            padding:14px 16px; border-bottom:1px solid var(--border);
        }
        .chat-header-title { font-size:14px; font-weight:600; }

        .chat-mode-tabs {
            display:flex; gap:2px; padding:8px 12px;
            background:var(--bg-card); border-bottom:1px solid var(--border);
        }
        .chat-mode-tab {
            flex:1; padding:6px 8px; border-radius:6px; font-size:12px;
            font-weight:500; color:var(--text-secondary); cursor:pointer;
            transition:all .2s; border:none; background:none;
            font-family:var(--sans); text-align:center;
        }
        .chat-mode-tab:hover { color:var(--text-primary); }
        .chat-mode-tab.active { color:var(--text-primary); background:rgba(255,255,255,0.08); }
        [data-theme="light"] .chat-mode-tab.active { background:rgba(0,0,0,0.06); }

        .chat-messages {
            flex:1; overflow-y:auto; padding:12px 16px;
            display:flex; flex-direction:column; gap:10px;
            min-height:200px; max-height:340px;
        }
        .chat-msg {
            max-width:85%; padding:10px 14px; border-radius:12px;
            font-size:13px; line-height:1.6; word-break:break-word;
        }
        .chat-msg.user {
            align-self:flex-end; background:var(--blue);
            color:#fff; border-bottom-right-radius:4px;
        }
        .chat-msg.ai {
            align-self:flex-start; background:var(--bg-card);
            border:1px solid var(--border); border-bottom-left-radius:4px;
        }
        .chat-msg.memo {
            align-self:flex-start; background:var(--amber-dim);
            border:1px solid rgba(251,191,36,0.2); border-bottom-left-radius:4px;
            color:var(--text-primary);
        }
        .chat-msg .msg-time {
            font-size:10px; color:var(--text-muted); margin-top:4px;
            display:block;
        }

        .chat-input-area {
            display:flex; gap:8px; padding:12px 16px;
            border-top:1px solid var(--border);
        }
        .chat-input {
            flex:1; padding:10px 14px; border-radius:var(--radius-sm);
            background:rgba(255,255,255,0.04); border:1px solid var(--border);
            color:var(--text-primary); font-size:13px; font-family:var(--sans);
            resize:none; min-height:40px; max-height:80px;
        }
        .chat-input:focus { outline:none; border-color:var(--blue); }
        [data-theme="light"] .chat-input { background:rgba(0,0,0,0.03); }
        .chat-send-btn {
            width:40px; height:40px; border-radius:var(--radius-sm);
            border:none; background:var(--blue); color:#fff;
            cursor:pointer; font-size:16px; transition:all .2s;
            display:flex; align-items:center; justify-content:center;
            flex-shrink:0;
        }
        .chat-send-btn:hover { background:var(--green); }
        .chat-send-btn:disabled { opacity:0.5; cursor:not-allowed; }

        /* ─── API SETTINGS ─── */
        .api-provider-card {
            padding:16px; border:1px solid var(--border); border-radius:var(--radius-sm);
            margin-bottom:12px; transition:all .2s;
        }
        .api-provider-card.active { border-color:var(--green); background:var(--green-dim); }
        .api-provider-header {
            display:flex; justify-content:space-between; align-items:center;
            margin-bottom:10px;
        }
        .api-provider-name { font-size:14px; font-weight:600; }
        .api-provider-badge {
            font-size:11px; padding:2px 8px; border-radius:10px;
        }
        .api-key-row { display:flex; gap:8px; align-items:center; }
        .api-key-input {
            flex:1; padding:8px 12px; border-radius:var(--radius-sm);
            background:rgba(255,255,255,0.04); border:1px solid var(--border);
            color:var(--text-primary); font-size:12px; font-family:var(--mono);
        }
        .api-key-input:focus { outline:none; border-color:var(--blue); }
        [data-theme="light"] .api-key-input { background:rgba(0,0,0,0.03); }
        .api-test-btn {
            padding:6px 14px; border-radius:var(--radius-sm); font-size:12px;
            font-weight:600; border:1px solid var(--blue); color:var(--blue);
            background:none; cursor:pointer; transition:all .2s;
            white-space:nowrap;
        }
        .api-test-btn:hover { background:var(--blue-dim); }
        .api-test-btn.testing { opacity:0.6; cursor:wait; }
        .api-test-result {
            font-size:12px; margin-top:8px; padding:6px 10px;
            border-radius:var(--radius-sm); display:none;
        }
        .api-test-result.success { display:block; background:var(--green-dim); color:var(--green); }
        .api-test-result.fail { display:block; background:var(--red-dim); color:var(--red); }
        .api-activate-btn {
            padding:4px 12px; border-radius:var(--radius-sm); font-size:11px;
            font-weight:600; border:1px solid var(--green); color:var(--green);
            background:none; cursor:pointer; transition:all .2s;
        }
        .api-activate-btn:hover { background:var(--green-dim); }

        /* ─── RESPONSIVE ─── */
        @media(max-width:1200px) { .g4{grid-template-columns:repeat(2,1fr);} .g3{grid-template-columns:1fr 1fr;} }
        @media(max-width:768px) {
            .g4,.g2,.g3,.g2e{grid-template-columns:1fr;}
            .app{padding:12px;}
            .chat-panel { width:calc(100% - 20px); right:10px; bottom:80px; }
        }
